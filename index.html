<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tanner West - Interactive Resume Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; background-image: radial-gradient(circle at top left, #1e293b, #0f172a); }
        #chat-window::-webkit-scrollbar { width: 6px; }
        #chat-window::-webkit-scrollbar-track { background: #1e293b; }
        #chat-window::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        .message-bubble-user { background-color: #2563eb; }
        .message-bubble-bot { background-color: #334155; }
        .prose ul { list-style-type: disc; padding-left: 1.5rem; margin-top: 0.5rem; }
        .prose a { color: #60a5fa; text-decoration: underline; }
        .prose strong { color: #f8fafc; }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 8px -2px #3b82f6; } 50% { box-shadow: 0 0 12px 0px #3b82f6; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .panel-glow { animation: glow 4s ease-in-out infinite; }
        .message-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="text-slate-200 flex items-center justify-center min-h-screen p-4">

    <main class="w-full max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 h-[95vh]">
        
        <div class="lg:col-span-1 bg-slate-900/70 border border-slate-700 rounded-2xl p-8 flex flex-col shadow-2xl backdrop-blur-sm panel-glow">
            <div>
                <img class="w-32 h-32 rounded-full mx-auto ring-4 ring-slate-700" src="https://placehold.co/256x256/1e293b/e2e8f0?text=TW" alt="Tanner West">
                <h1 class="text-center text-3xl font-bold mt-6 text-white">Tanner West</h1>
                <h2 class="text-center text-lg text-blue-400 font-medium">Game Developer & Sound Designer</h2>
            </div>
            <div class="mt-8 pt-8 border-t border-slate-700">
                <h3 class="text-white font-semibold">Resume & Links</h3>
                <div class="mt-4 space-y-3">
                     <a href="https://docs.google.com/document/d/1-YDX3SCVV28yqYZE9dz4kZC7v-9CdMJsTbyCrj8BSYo/edit?usp=sharing" target="_blank" class="flex items-center space-x-3 text-slate-300 hover:text-blue-400 group">
                        <svg class="w-6 h-6 flex-shrink-0" fill="currentColor" viewBox="0 0 256 256"><path d="M216,40H88a16,16,0,0,0-16,16V88H40a16,16,0,0,0-16,16v96a16,16,0,0,0,16,16H168a16,16,0,0,0,16-16V184h32a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM160,192H48V112H160Zm48-48H184V112a16,16,0,0,0-16-16H80V64H208Z"></path></svg>
                        <span>Resume Document</span>
                    </a>
                    <a href="https://twest-games.itch.io/" target="_blank" class="flex items-center space-x-3 text-slate-300 hover:text-blue-400 group">
                        <svg class="w-6 h-6 flex-shrink-0" fill="currentColor" viewBox="0 0 256 256"><path d="M228.8,32H27.2A11.2,11.2,0,0,0,16,43.2V212.8A11.2,11.2,0,0,0,27.2,224H228.8A11.2,11.2,0,0,0,240,212.8V43.2A11.2,11.2,0,0,0,228.8,32ZM104,112.55,76,144H56V96H70.67L97.2,125.88V96h14.4V144H99.11ZM168,144H128V128h34.67V112H128V96h40a16,16,0,0,1,16,16v16A16,16,0,0,1,168,144Zm40-32a8,8,0,1,1,8,8A8,8,0,0,1,208,112Z"></path></svg>
                        <span>itch.io Profile</span>
                    </a>
                </div>
            </div>
             <div class="mt-auto pt-6 text-center text-xs text-slate-500">
                <p>This is an AI-powered interactive resume. Ask the assistant any question about my background.</p>
            </div>
        </div>

        <div class="lg:col-span-2 bg-slate-900/70 border border-slate-700 rounded-2xl shadow-2xl flex flex-col h-full backdrop-blur-sm panel-glow">
            <div class="p-5 border-b border-slate-700 rounded-t-2xl">
                <h1 class="text-xl font-bold text-white">Interactive Assistant</h1>
                <p class="text-slate-400 text-sm mt-1">Try asking: "How do you approach debugging?"</p>
            </div>
            <div id="chat-window" class="flex-1 p-6 overflow-y-auto space-y-6"></div>
            <div id="loading-indicator" class="hidden p-6 pt-0">
                 <div class="flex items-center space-x-3"><div class="w-2 h-2 rounded-full bg-blue-400 animate-pulse"></div><div class="w-2 h-2 rounded-full bg-blue-400 animate-pulse" style="animation-delay: 0.2s;"></div><div class="w-2 h-2 rounded-full bg-blue-400 animate-pulse" style="animation-delay: 0.4s;"></div><p class="text-slate-400 text-sm">Assistant is thinking...</p></div>
            </div>
            <div class="p-5 border-t border-slate-700">
                <form id="chat-form" class="flex items-start space-x-4">
                    <textarea id="chat-input" placeholder="Ask a question... (Shift+Enter for new line)" rows="1" class="flex-1 p-3 bg-slate-800 border border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none transition text-slate-200 resize-none"></textarea>
                    <button type="submit" class="bg-blue-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-blue-700 transition">Send</button>
                </form>
            </div>
        </div>
    </main>
    
    <script>
        const resumeData = { /* The resumeData object from the original file is preserved here */ };

        const chatWindow = document.getElementById('chat-window');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const loadingIndicator = document.getElementById('loading-indicator');

        document.addEventListener('DOMContentLoaded', () => { appendMessage('bot', `Hello! I'm an AI assistant for Tanner West's resume. How can I help you?`); });

        const submitForm = async () => {
            const userMessage = chatInput.value.trim();
            if (!userMessage) return;

            appendMessage('user', userMessage);
            chatInput.value = '';
            chatInput.style.height = 'auto';
            loadingIndicator.classList.remove('hidden');
            
            try {
                const botResponse = await getBotResponse(userMessage);
                appendMessage('bot', botResponse);
                // NEW: Log the conversation after getting a response
                await logConversation(userMessage, botResponse);
            } catch (error) {
                console.error("Error:", error);
                appendMessage('bot', `Sorry, there was an error connecting to the assistant. Details: ${error.message}`);
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        };

        chatForm.addEventListener('submit', (e) => { e.preventDefault(); submitForm(); });
        chatInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); submitForm(); } });
        chatInput.addEventListener('input', () => { chatInput.style.height = 'auto'; chatInput.style.height = (chatInput.scrollHeight) + 'px'; });

        function appendMessage(sender, message) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `flex items-start gap-3 message-fade-in ${sender === 'user' ? 'flex-row-reverse' : ''}`;
            const avatar = document.createElement('div');
            avatar.className = 'w-8 h-8 rounded-full bg-slate-700 flex-shrink-0 flex items-center justify-center font-bold text-sm';
            avatar.textContent = sender === 'user' ? 'You' : 'AI';
            if (sender === 'user') { avatar.classList.add('bg-blue-600'); }
            const messageContent = document.createElement('div');
            messageContent.className = `prose prose-invert max-w-none p-3 rounded-lg shadow-md ${sender === 'user' ? 'message-bubble-user' : 'message-bubble-bot'}`;
            messageContent.innerHTML = marked.parse(message);
            messageWrapper.append(avatar, messageContent);
            chatWindow.appendChild(messageWrapper);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        /**
         * NEW: Gets the user's approximate location from their IP address.
         * Uses a free service that does not require an API key.
         */
        async function getLocationFromIp() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                if (!response.ok) return "Location Not Found";
                const data = await response.json();
                return `${data.city || 'Unknown City'}, ${data.region || 'N/A'}, ${data.country_name || 'Unknown Country'}`;
            } catch (error) {
                console.error("Could not fetch IP location:", error);
                return "Location Fetch Error";
            }
        }

        /**
         * NEW: Gathers conversation data and location, then logs it.
         * This is where you would send the data to your backend (e.g., Google Apps Script).
         */
        async function logConversation(userQuestion, botResponse) {
            const location = await getLocationFromIp();
            
            const logData = {
                timestamp: new Date().toISOString(),
                location: location,
                user_question: userQuestion,
                bot_response: botResponse,
            };

            // For now, this will just print the data to your browser's console.
            // Replace this with a fetch() call to your backend endpoint to save the data.
            console.log("Conversation data to be logged:", logData);
            
            /*
            // --- EXAMPLE: Sending data to a Google Apps Script ---
            const backendUrl = "YOUR_GOOGLE_APPS_SCRIPT_URL_HERE";
            try {
                await fetch(backendUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(logData)
                });
            } catch (error) {
                console.error("Failed to log conversation to backend:", error);
            }
            */
        }

        async function getBotResponse(userMessage) {
            const obfuscatedKey = "QUl6YVN5RGd5YzNoTE9tcGlyVVNwaE5RWGFOZ19Ba1E5U1d0MkVN";
            const apiKey = atob(obfuscatedKey);
            
            const fullPrompt = `You are a professional chatbot assistant for ${resumeData.fullName}'s resume...`; // Prompt is preserved
            
            // --- CRITICAL FIX ---
            // The model name has been updated to a valid one to prevent API errors.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: fullPrompt }] }] }) 
            });

            if (!response.ok) {
                const errorBody = await response.text();
                throw new Error(`API Error: ${response.status}. ${errorBody}`);
            }
            
            const result = await response.json();
            
            if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts) {
                return result.candidates[0].content.parts[0].text;
            } else {
                // This handles cases where the response might be blocked for safety reasons.
                if (result.candidates && result.candidates[0].finishReason === 'SAFETY') {
                    return "The response was blocked due to safety settings. Please rephrase your question.";
                }
                throw new Error("The AI service returned an unexpected or empty response.");
            }
        }
    </script>
</body>
</html>
